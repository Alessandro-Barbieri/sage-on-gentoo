--- doc/common/builder.py.orig	2009-12-04 11:17:16.454656783 +0000
+++ doc/common/builder.py	2009-12-07 13:28:59.361752625 +0000
@@ -14,6 +14,11 @@
 #                Options                 #
 ##########################################
 SAGE_DOC = os.environ['SAGE_DOC']
+SAGE_DOC_DEST = os.environ['SAGE_DOC_DEST']
+
+if SAGE_DOC_DEST == '':
+    SAGE_DOC_DEST = SAGE_DOC
+
 LANGUAGES = ['en', 'fr']
 SPHINXOPTS  = ""
 PAPER       = ""
@@ -110,11 +115,11 @@
     """
     def f(self):
         output_dir = self._output_dir(type)
-        os.chdir(self.dir)
+        os.chdir(self.destdir)
 
         build_command = 'sphinx-build'
         build_command += ' -b %s -d %s %s %s %s'%(type, self._doctrees_dir(),
-                                                  ALLSPHINXOPTS, self.dir,
+                                                  ALLSPHINXOPTS, self.srcdir,
                                                   output_dir)
         logger.warning(build_command)
         subprocess.call(build_command, shell=True)
@@ -139,11 +144,12 @@
             lang, name = name.split(os.path.sep)
         self.name = name
         self.lang = lang
-        self.dir = os.path.join(SAGE_DOC, lang, name)
+        self.srcdir = os.path.join(SAGE_DOC, lang, name)
+        self.destdir = os.path.join(SAGE_DOC_DEST, lang, name)
 
         #Make sure the .static and .templates directories are there
-        mkdir(os.path.join(self.dir, "static"))
-        mkdir(os.path.join(self.dir, "templates"))
+        mkdir(os.path.join(self.destdir, "static"))
+        mkdir(os.path.join(self.destdir, "templates"))
 
     def _output_dir(self, type):
         """
@@ -158,7 +164,7 @@
             sage: b._output_dir('html')
             '.../devel/sage/doc/output/html/en/tutorial'
         """
-        return mkdir(os.path.join(SAGE_DOC, "output", type, self.lang, self.name))
+        return mkdir(os.path.join(SAGE_DOC_DEST, "output", type, self.lang, self.name))
 
     def _doctrees_dir(self):
         """
@@ -173,7 +179,7 @@
             sage: b._doctrees_dir()
             '.../devel/sage/doc/output/doctrees/en/tutorial'
         """
-        return mkdir(os.path.join(SAGE_DOC, "output", 'doctrees', self.lang, self.name))
+        return mkdir(os.path.join(SAGE_DOC_DEST, "output", 'doctrees', self.lang, self.name))
 
     def _output_formats(self):
         """
@@ -360,10 +366,10 @@
             self.write_auto_rest_file(module_name)
 
         #Copy over the custom .rst files from _sage
-        _sage = os.path.join(self.dir, '_sage')
+        _sage = os.path.join(self.srcdir, '_sage')
         if os.path.exists(_sage):
             logger.info("Copying over custom .rst files from %s ...", _sage)
-            copytree(_sage, os.path.join(self.dir, 'sage'))
+            copytree(_sage, os.path.join(self.destdir, 'sage'))
                 
         getattr(DocBuilder, build_type)(self, *args, **kwds)
     
@@ -470,8 +476,8 @@
         Returns an iterator for all rst files which are not
         autogenerated.
         """
-        for directory, subdirs, files in os.walk(self.dir):
-            if exclude_sage and directory.startswith(os.path.join(self.dir, 'sage')):
+        for directory, subdirs, files in os.walk(self.srcdir):
+            if exclude_sage and directory.startswith(os.path.join(self.srcdir, 'sage')):
                 continue
             for filename in files:
                 if not filename.endswith('.rst'):
@@ -561,7 +567,7 @@
         """
         if not module_name.startswith('sage'):
             return
-        filename = self.dir + os.path.sep + module_name.replace('.',os.path.sep) + '.rst'
+        filename = self.destdir + os.path.sep + module_name.replace('.',os.path.sep) + '.rst'
         mkdir(os.path.dirname(filename))
         
         outfile = open(filename, 'w')
@@ -591,9 +597,9 @@
 
         import shutil
         try:
-            shutil.rmtree(os.path.join(self.dir, 'sage'))
+            shutil.rmtree(os.path.join(self.destdir, 'sage'))
             logger.debug("Deleted auto-generated .rst files in: %s",
-                         os.path.join(self.dir, 'sage'))
+                         os.path.join(self.destdir, 'sage'))
         except OSError:
             pass
 
@@ -1003,7 +1009,7 @@
         update_mtimes = False
 
     # Make sure common/static exists.
-    mkdir(os.path.join(SAGE_DOC, 'common', 'static'))
+    mkdir(os.path.join(SAGE_DOC_DEST, 'common', 'static'))
 
     # Get the builder and build.
     getattr(get_builder(name), type)()
