--- configure.ac.orig	2010-05-02 21:36:01.246139195 +1200
+++ configure.ac	2010-05-02 22:06:26.256138471 +1200
@@ -3,6 +3,7 @@
 AC_PREREQ(2.59)
 AC_INIT(IML, 1.0.3)
 AC_CONFIG_AUX_DIR(config)
+AC_CONFIG_MACRO_DIR(config)
 AM_CONFIG_HEADER(config.h:config-h.in)
 AC_CONFIG_SRCDIR([src/RNSop.c])
 AM_INIT_AUTOMAKE
@@ -47,19 +48,37 @@
 
 IML_VERBOSE_MODE
 IML_DEFAULT_PATH
-IML_CHECK_GMP(,,[AC_MSG_ERROR(
-GMP not found! 
-GMP version 3.1.1 or greater is required for this library to compile. 
-Please make sure GMP is installed and specify the header and libraries 
-location with the options --with-gmp-include=<path> and --with-gmp-lib=<path>
-respectively when running configure.
-)])
-
-IML_CHECK_ATLAS(,,[AC_MSG_ERROR(
-ATLAS not found! 
-ATLAS version 3.0 or greater is required for this library to compile. Please make sure ATLAS is installed and specify the header and libraries location with the options --with-atlas-include=<path> and --with-atlas-lib=<path> respectively when running configure.
-)])
 
+AC_ARG_ENABLE(mpir,
+              AC_HELP_STRING([--enable-mpir],[Uses mpir instead of gmp.]))
+
+AS_IF([test "x$enable_mpir" = "xyes"], [
+              GMP_CFLAGS="-DMPIR"
+])
+
+AC_ARG_WITH(gmp-lib,
+            AC_HELP_STRING([--with-gmp-lib=<lib>],[Specify the flags for either gmp or mpir. Note that mpir needs to be specified explicitely]),
+            with_gmp_lib=$withval)
+
+case $with_gmp_lib in
+	"" ) GMP_LIBS="-lgmp" ;;
+	*) GM_LIBS="$with_gmp_lib" ;;
+esac
+AC_SUBST(GMP_CFLAGS)
+AC_SUBST(GMP_LIBS)
+
+AC_CHECK_HEADERS([cblas.h],
+	[cblas_headers_found=yes; break;])
+
+AS_IF([test "x$cblas_headers_found" != "xyes"],
+	[AC_MSG_ERROR([Unable to find the cblas headers check your installation])])
+
+AC_ARG_WITH(cblas-lib,
+            AC_HELP_STRING([--with-cblas-lib=<lib>],[Specify the flags for cblas.]),
+            with_cblas_lib=$withval)
+ATLAS_LIBS="$with_cblas_lib"
+
+AC_SUBST(ATLAS_LIBS)
 AC_SUBST(LDFLAGS)
 AC_SUBST(ac_aux_dir)
 	
--- src/certsolve.h.orig	2010-05-02 22:08:19.376138160 +1200
+++ src/certsolve.h	2010-05-02 22:12:28.014138318 +1200
@@ -100,7 +100,11 @@
 #define CERTSOLVE_H 1
 
 #include "cblas.h"
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "common.h"
 #include "basisop.h"
 #include "latreduce.h"
--- src/mtrans.h.orig	2010-05-02 22:08:28.780139028 +1200
+++ src/mtrans.h	2010-05-02 22:12:55.181138963 +1200
@@ -49,7 +49,11 @@
 #define MTRANS_H 1
 
 #include "cblas.h"
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "basisop.h"
 #include "common.h"
 #include "error.h"
--- src/padiclift.h.orig	2010-05-02 22:08:42.197139828 +1200
+++ src/padiclift.h	2010-05-02 22:13:17.871140688 +1200
@@ -67,7 +67,11 @@
 #define PADICLIFT_H 1
 
 #include "cblas.h"
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "basisop.h"
 #include "common.h"
 #include "mtrans.h"
--- src/reconsolu.h.orig	2010-05-02 22:08:53.233139149 +1200
+++ src/reconsolu.h	2010-05-02 22:13:34.585138129 +1200
@@ -67,7 +67,11 @@
 #ifndef RECONSOLU_H
 #define RECONSOLU_H 1
 
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "common.h"
 #include "iml.h"
 #include "RNSop.h"
--- src/RNSop.h.orig	2010-05-02 22:09:03.167138883 +1200
+++ src/RNSop.h	2010-05-02 22:13:51.812139052 +1200
@@ -90,7 +90,11 @@
 #define RNSOP_H 1
 
 #include "cblas.h"
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "basisop.h"
 #include "common.h"
 #include "iml.h"
--- src/basisop.h.orig	2010-05-02 22:09:12.816138593 +1200
+++ src/basisop.h	2010-05-02 22:14:08.290139139 +1200
@@ -70,7 +70,11 @@
 #ifndef BASISOP_H
 #define BASISOP_H 1
 
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "common.h"
 #include "iml.h"
 
--- src/nullspace.h.orig	2010-05-02 22:09:22.122138500 +1200
+++ src/nullspace.h	2010-05-02 22:14:20.385140288 +1200
@@ -47,7 +47,11 @@
 
 #ifndef IML_NULLSPACE_H
 #define IML_NULLSPACE_H 1
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "common.h"
 #include "iml.h"
 #include "mtrans.h"
--- src/nonsysolve.h.orig	2010-05-02 22:09:33.831138551 +1200
+++ src/nonsysolve.h	2010-05-02 22:14:36.012138313 +1200
@@ -68,7 +68,11 @@
 #ifndef NONSYSOLVE_H 
 #define NONSYSOLVE_H 1
 
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "basisop.h"
 #include "common.h"
 #include "padiclift.h"
--- src/latreduce.h.orig	2010-05-02 22:09:43.149138402 +1200
+++ src/latreduce.h	2010-05-02 22:14:52.523138180 +1200
@@ -49,7 +49,11 @@
 #ifndef LATREDUCE_H
 #define LATREDUCE_H 1
 
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 #include "common.h"
 
 #define A(i,j) *(AA+(i)*m+j)
--- tests/test-largeentry.c.orig	2010-05-02 22:09:55.154139630 +1200
+++ tests/test-largeentry.c	2010-05-02 22:15:23.047139010 +1200
@@ -47,7 +47,11 @@
 
 /* test file for large entry (mpz_t) input matrix */
 
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 
 #include "../src/common.h"
 #include "../src/iml.h"
--- tests/test-smallentry.c.orig	2010-05-02 22:10:11.651138363 +1200
+++ tests/test-smallentry.c	2010-05-02 22:15:36.189138463 +1200
@@ -47,7 +47,11 @@
 
 /* test file for small entry (signed long) input matrix */
 
+#ifdef MPIR
+#include "mpir.h"
+#else
 #include "gmp.h"
+#endif
 
 #include "../src/common.h"
 #include "../src/iml.h"
--- Makefile.am~	2009-11-23 11:38:44.000000000 +1300
+++ Makefile.am	2009-11-23 11:38:44.000000000 +1300
@@ -1,3 +1,5 @@
+ACLOCAL_AMFLAGS = -I config
+
 EXTRA_DIST = bootstrap

 SUBDIRS = repl config src doc tests examples
